<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Manutenção</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kpi-main': '#30395e',
                        'kpi-dark': '#262f4e',
                        'kpi-accent': '#00f6ff',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'danger': '#ef4444'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-kpi-main font-sans">
    <div class="flex min-h-screen">
        <!-- Barra Lateral -->
        <aside class="bg-kpi-dark w-20 flex flex-col items-center py-6 space-y-8">
            <div class="w-10 h-10 bg-kpi-accent rounded-md flex items-center justify-center">
                <svg class="w-6 h-6 text-kpi-dark" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                </svg>
            </div>
            <button id="btn-dashboard" class="p-2 text-kpi-accent bg-gray-700/50 rounded-lg" title="Dashboard">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V4zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                </svg>
            </button>
            <button id="btn-upload" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Upload CSV">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
            </button>
            <button id="btn-analytics" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Análises">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
            </button>
            <button id="btn-predictive" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Preditiva">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
            </button>
            <button id="btn-edit" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Editar Dados">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
            </button>
            <button id="btn-settings" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Configurações">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
            <button id="btn-export" class="p-2 text-gray-400 hover:text-kpi-accent rounded-lg" title="Exportar">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
            </button>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            <!-- Header -->
            <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <div>
                    <p class="text-gray-400 text-lg">Bem-vindo ao</p>
                    <p class="text-white text-2xl font-bold">Dashboard de Manutenção</p>
                </div>
                <div class="flex items-center space-x-4 mt-2 md:mt-0">
                    <button id="btn-save-pdf" class="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                        Salvar Relatório (PDF)
                    </button>
                    <button id="btn-refresh" class="bg-kpi-accent text-kpi-dark px-4 py-2 rounded-lg font-semibold hover:bg-white transition-colors">
                        Atualizar Dados
                    </button>
                    <div id="date-time-display" class="text-gray-300 text-lg font-medium"></div>
                </div>
            </header>

            <!-- Filtros do Dashboard -->
            <div id="dashboard-filters" class="hidden bg-kpi-dark rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-4">
                    <label class="text-white">Filtrar por:</label>
                    <select id="filter-year" class="bg-kpi-dark text-white px-3 py-2 rounded-lg border border-gray-600">
                        <option value="">Todos os Anos</option>
                    </select>
                    <select id="filter-month" class="bg-kpi-dark text-white px-3 py-2 rounded-lg border border-gray-600">
                        <option value="">Todos os Meses</option>
                        <option value="0">Janeiro</option>
                        <option value="1">Fevereiro</option>
                        <option value="2">Março</option>
                        <option value="3">Abril</option>
                        <option value="4">Maio</option>
                        <option value="5">Junho</option>
                        <option value="6">Julho</option>
                        <option value="7">Agosto</option>
                        <option value="8">Setembro</option>
                        <option value="9">Outubro</option>
                        <option value="10">Novembro</option>
                        <option value="11">Dezembro</option>
                    </select>
                </div>
            </div>

            <!-- Status de Carregamento -->
            <div id="loading-indicator" class="hidden bg-kpi-dark rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-3">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-kpi-accent"></div>
                    <span class="text-white">Carregando dados...</span>
                </div>
            </div>

                        <!-- View de Edição de Dados -->
            <div id="edit-view" class="hidden">
                <div class="bg-kpi-dark rounded-lg p-6 mb-6">
                    <h2 class="text-xl text-white font-bold mb-4">Editar Dados</h2>
                    <div class="overflow-x-auto">
                        <table id="edit-table" class="min-w-full text-white">
                            <thead class="bg-kpi-main">
                                <tr>
                                    <th class="px-4 py-2">Data</th>
                                    <th class="px-4 py-2">Equipamento</th>
                                    <th class="px-4 py-2">Tipo</th>
                                    <th class="px-4 py-2">Descrição</th>
                                    <th class="px-4 py-2">Duração (h)</th>
                                    <th class="px-4 py-2">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="edit-table-body"></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 space-x-4">
                        <button id="btn-cancel-edit" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                            Cancelar
                        </button>
                        <button id="btn-save-edit" class="bg-kpi-accent text-kpi-dark px-4 py-2 rounded-lg hover:bg-white">
                            Salvar Alterações
                        </button>
                    </div>
                </div>
            </div>

            <!-- Upload de Arquivo -->
            <div id="upload-view" class="hidden space-y-8">
                <h2 class="text-xl text-white font-semibold mb-4">UPLOAD DE ARQUIVO CSV</h2>
                <div class="bg-kpi-dark rounded-lg p-6">
                    <div class="mb-4">
                        <label class="block text-white text-sm font-medium mb-2">
                            Selecione um arquivo CSV (.csv)
                        </label>
                        <input type="file" id="excel-file-input" accept=".csv" 
                               class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-kpi-main file:text-kpi-accent hover:file:bg-kpi-accent hover:file:text-kpi-main cursor-pointer">
                    </div>
                    <button id="btn-process-file" class="bg-kpi-accent text-kpi-dark font-bold px-6 py-3 rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed">
                        Processar Arquivo
                    </button>
                    <div id="upload-status" class="mt-4 text-sm text-gray-400">
                        Selecione um arquivo CSV para começar a análise.
                    </div>
                </div>
            </div>

            <!-- Dashboard Principal -->
            <div id="dashboard-view" class="space-y-8">
                <!-- KPIs Principais -->
                <div class="mb-8">
                    <h2 class="text-xl text-white font-semibold mb-4">VISÃO GERAL DO PAINEL</h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">Corretivas</h3>
                            <p id="kpi-corretivas" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">Preventivas</h3>
                            <p id="kpi-preventivas" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-warning rounded-lg p-4 text-white">
                            <h3 class="font-medium">Preventivas Venc.</h3>
                            <p id="kpi-preventivas-venc" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">Preditivas</h3>
                            <p id="kpi-preditivas" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">Melhorias</h3>
                            <p id="kpi-melhorias" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">Equipamentos</h3>
                            <p id="kpi-equipamentos" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4 text-gray-800">
                            <h3 class="font-medium text-gray-500">O.S Total</h3>
                            <p id="kpi-os-total" class="text-4xl font-bold">0</p>
                        </div>
                        <div class="bg-success rounded-lg p-4 text-white">
                            <h3 class="font-medium">Disponibilidade</h3>
                            <p id="kpi-availability" class="text-4xl font-bold">0%</p>
                        </div>
                        <div class="bg-success rounded-lg p-4 text-white col-span-2 md:col-span-2 lg:col-span-2">
                            <h3 class="font-medium">Custo Total</h3>
                            <p id="kpi-custo-total" class="text-4xl font-bold">R$ 0,00</p>
                        </div>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">MTTR (Tempo Médio de Reparo)</h3>
                        </div>
                        <div class="h-64"><canvas id="mttrChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">MTBF (Tempo Médio Entre Falhas)</h3>
                        </div>
                        <div class="h-64"><canvas id="mtbfChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Custos Mensais de Manutenção</h3>
                        </div>
                        <div class="h-64"><canvas id="monthlyCostsChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">O.S Corretivas Mensais</h3>
                        </div>
                        <div class="h-64"><canvas id="monthlyCorrectivesChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Ordens por Status Mensal</h3>
                        </div>
                        <div class="h-64"><canvas id="monthlyStatusChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Ordens por Tipo de Manutenção</h3>
                        </div>
                        <div class="h-64"><canvas id="maintenanceTypeChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Ordens por Criticidade</h3>
                        </div>
                        <div class="h-64"><canvas id="criticalityChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Top 5 Equipamentos com Mais Ordens</h3>
                        </div>
                        <div class="h-64"><canvas id="topEquipmentChart"></canvas></div>
                    </div>
                    <div class="bg-kpi-dark rounded-lg p-4 lg:col-span-3">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-white font-medium">Ordens por Analista</h3>
                        </div>
                        <div class="h-64"><canvas id="analystChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Análise de Equipamentos -->
            <div id="analytics-view" class="hidden space-y-8">
                <h2 class="text-xl text-white font-semibold mb-4">ANÁLISE POR EQUIPAMENTO</h2>
                <div class="bg-kpi-dark rounded-lg p-6">
                    <div id="equipment-analysis-content">
                        <p class="text-gray-400">Carregue um arquivo CSV para ver a análise de equipamentos.</p>
                    </div>
                </div>
            </div>

            <!-- Análise Preditiva -->
            <div id="predictive-view" class="hidden space-y-8">
                <h2 class="text-xl text-white font-semibold mb-4">ANÁLISE PREDITIVA</h2>
                <div class="bg-kpi-dark rounded-lg p-6">
                    <div id="predictive-analysis-content">
                        <p class="text-gray-400">Carregue um arquivo CSV para ver a análise preditiva.</p>
                    </div>
                </div>
            </div>

            <!-- Edição de Dados -->
            <div id="edit-view" class="hidden space-y-8">
                <h2 class="text-xl text-white font-semibold mb-4">EDITAR DADOS</h2>
                <div class="bg-kpi-dark rounded-lg p-6">
                    <div id="edit-content">
                        <p class="text-gray-400">Funcionalidade de edição em desenvolvimento.</p>
                    </div>
                </div>
            </div>

            <!-- Configurações -->
            <div id="settings-view" class="hidden space-y-8">
                <h2 class="text-xl text-white font-semibold mb-4">CONFIGURAÇÕES</h2>
                <div class="bg-kpi-dark rounded-lg p-6">
                    <div id="settings-content">
                        <p class="text-gray-400">Funcionalidade de configurações em desenvolvimento.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>